<p align="center">
	<img alt="cyclops" src="https://user-images.githubusercontent.com/43391199/188023104-2b25329b-2fb6-4791-b9a5-325f9a41de8b.png" width="350">
</p>

**cyclops** is a minimalist developer tool that can be used to efficiently generate directed graphs from your JavaScript/Node.js project. It can automatically collect metadata, detect circular dependencies and can be used to implement affected/incremental patterns as it exposes a way to know precisely dependencies for each graph node.

_Graph Construction_
**cyclops** is powered by [digraph-js](https://github.com/antoine-coulon/digraph-js), a _0 dependency_ Node.js library to make Directed Graph construction and traversal effortless.

> **Note**
>
> **cyclops** goal is to represent all the file tree structure but was designed to only include dependencies currently being used in the project based on the entrypoint. Consequently unused files (files that are not imported/exported by any other file) won't be included in the graph structure.

âœ… Works for **JavaScript/Node.js** projects (ECMAScript and CommonJS modules)

âœ… Deeply detects **circular dependencies** in an efficient way, with the ability to provide a max depth for the search

âœ… Deeply **collect all dependencies of the project graph**

âœ… Deep **parent and child dependencies traversals**

âœ… Node.js core, binary and JSON modules are excluded by default

âœ… Third-party libraries are excluded by default

Work in progress includes:

ðŸ›  Allow unused dependency to be flagged

ðŸ›  Caching on graph operations to provide better traversal efficiency

ðŸ›  Collect metadata on the graph (unused imports, unoptimized imports)

ðŸ›  Collect metadata on each traversed node (file size, number of other nodes depending on it, etc)

ðŸ›  Resolve workspaces/monorepos graphs

## How to use Cyclops

### **API**

```javascript
import cyclops from "cyclops";

const { getStructure, findCircularDependencies, findParentsOf } = await cyclops({
  /**
   * The entrypoint of the project. Must be either a CommonJS or ES6 module.
   * No TypeScript files are supported as entrypoints.
   */ 
  entrypoint: "dist/index.js",
  /**
   * Define the max depth of for circular dependencies search. This can be useful 
   * for performance purposes. This defaults to POSITIVE_INFINITY.
   */
  circularMaxDepth: 20,
  /**
   * This defines whether the base directory of the entrypoint must be included
   * in all the relatives file paths.
   * For the specified `dist/index.js` above, it would consider the root path
   * to be `./` consequently `dist/` would never appear in any file paths.
   */
  includeBaseDir: false
});
```

### **Command line interface**

Cyclops exposes a CLI directly using features from the core library.

When the library installed locally you can run:

```bash
$ ./node_modules/.bin/cyclops src/index.js
```

When the library installed globally:

```bash
$ cyclops src/index.js
```

Here are some examples of output generated by the CLI:

Example targetting [Fastify](https://www.fastify.io/) using **"graph"** display mode:

<p>
    <img width="350" src="https://user-images.githubusercontent.com/43391199/187035492-6cb4532d-289c-462e-80a3-4c74d0c91f8d.png">
</p>

Using **"file-tree"** display mode:

<p>
    <img width="350" src="https://user-images.githubusercontent.com/43391199/187035652-21b91436-07fb-4aa1-8b1d-30e07cd97b04.png">
</p>

When circular dependencies are met:

<p>
    <img width="350" src="https://user-images.githubusercontent.com/43391199/187143867-665c22ea-743c-4734-88a7-f8b7415cf224.png">
</p>

See all the options of the CLI running:

```bash
$ cyclops --help
```

## Examples

To initialize the dependency graph, the default exported function must be used first.
Once executed, the default function returns a set of functions to retrieve some
information about the graph just built.

```javascript
import cyclops from "cyclops";

const { getStructure } = await cyclops({
  entrypoint: "index.js",
  // ...rest of the config
});

const { graph, files } = getStructure();
console.log(graph); // logs { "index.js": {Â id: "index.js", adjacentTo: [], body: {...} } };
console.log(files); // logs [ "index.js" ]
```

### Search for circular dependencies

```javascript
import cyclops from "cyclops";

const { findCircularDependencies, hasCircularDependencies } = await cyclops({
  entrypoint: "index.js",
  // ...rest of the config
});

// Imagine that starting from "index.js" cyclops detects a circular dependency
// between "core.js" and "utils.js" files

console.log(findCircularDependencies()); // logs [ [ "core.js", "utils.js" ] ]
console.log(hasCircularDependencies()); // logs "true"
```

### Search for leaves (nodes with no children)

leaf.js

```javascript
console.log("I'm a leaf because I have no dependency");
```

index.js

```javascript
import cyclops from "cyclops";

const { findLeaves } = await cyclops({
  entrypoint: "leaf.js",
  // ...rest of the config
});

console.log(findLeaves()); // logs [ "leaf.js" ]
```

### Deeply search for parent dependencies of a given node

children.js

```javascript
export const childrenFunction = () => {};
```

parent.js

```javascript
import { childrenFunction } from "./children.js";

childrenFunction();
```

index.js

```javascript
import cyclops from "cyclops";

const { findParentsOf } = await cyclops({
  entrypoint: "parent.js",
  // ...rest of the config
});

console.log(findParentsOf("children.js")); // logs [ "parent.js" ]
```
